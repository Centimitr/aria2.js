!function(a){"use strict";var b,c,d;if("undefined"!=typeof module&&module.exports){b=require("ws"),c=function(a){return new Buffer(a).toString("base64")};var e=require("httpclient");d=function(a,b){var d={host:this.host,port:this.port,path:"/jsonrpc",secure:this.secure,query:{method:a.method,id:a.id,params:"object"==typeof a.params&&null!==a.params?c(JSON.stringify(a.params)):void 0}};e(d,function(a,c){if(a)return b(a);var d=JSON.parse(c.body.toString());this._onmessage(d)}.bind(this))}}else b=a.WebSocket,c=atob,d=function(b,d){var e="aria2jsonp"+Date.now(),f=this.secure===!0?"https":"http",g=f+"://"+this.host+":"+this.port+"/jsonrpc?jsoncallback="+e+"&id="+b.id+"&method="+b.method;b.params&&(g+="&params="+c(JSON.stringify(b.params)));var h=document.createElement("script");h.src=g,h.async=!0,a[e]=function(b){this._onmessage(b),delete a[e],delete h.onerror,h.parentNode.remove(h)}.bind(this),h.onerror=function(a){d(a),delete h.onerror,h.parentNode.remove(h)};var i=document.head||document.getElementsByTagName("head")[0];i.appendChild(h)};var f={secure:!1,host:"localhost",port:8600},g=function(a){this.callbacks={},this.lastId=0;for(var b in f)this[b]="object"==typeof a&&b in a?a[b]:f[b]};["open","close","send","message"].forEach(function(a){g.prototype["on"+a]=function(){}}),g.prototype.http=d,g.prototype.send=function(a,b,c){var d={method:"aria2."+a,"json-rpc":"2.0",id:this.lastId++};return"function"==typeof b?c=b:d.params=b,c&&(this.callbacks[d.id]=c),this.onsend(d),this.socket&&1===this.socket.readyState?this.socket.send(JSON.stringify(d)):void this.http(d,function(a){c(a),delete this.callbacks[d.id]}.bind(this))},g.prototype._onmessage=function(a){if(void 0!==a.id){var b=this.callbacks[a.id];b&&(a.error?b(a.error):a.result&&b(void 0,a.result),delete this.callbacks[a.id])}else if(a.method){var c=a.method.split("aria2.")[1];c in g.notifications&&this[c](a.params)}this.onmessage(a)},g.prototype.open=function(a){a=a||(this.secure?"wss":"ws")+"://"+this.host+":"+this.port+"/jsonrpc",this.socket=new b(a),this.socket.onopen=this.onopen.bind(this),this.socket.onclose=this.onclose.bind(this),this.socket.onmessage=function(a){this._onmessage(JSON.parse(a.data))}.bind(this)},g.prototype.close=function(){this.socket.close()},g.methods={addUri:{},addTorrent:{},addMetalink:{},remove:{},forceRemove:{},pause:{},pauseAll:{},forcePause:{},forcePauseAll:{},unpause:{},unpauseAll:{},tellStatus:{},getUris:{},getFiles:{},getPeers:{},getServers:{},tellActive:{},tellWaiting:{},tellStopped:{},changePosition:{},changeUri:{},getOption:{},changeOption:{},getGlobalOption:{},changeGlobalOption:{},getGlobalStat:{},purgeDownloadResult:{},removeDownloadResult:{},getVersion:{},getSessionInfo:{},shutdown:{},forceShutdown:{}},g.notifications={onDownloadStart:{},onDownloadPause:{},onDownloadStop:{},onDownloadComplete:{},onDownloadError:{},onBtDownloadComplete:{}};for(var h in g.methods)!function(a){g.prototype[a]=function(){this.send(a,arguments[0],arguments[1])}}(h);for(var i in g.notifications)g.prototype[i]=function(){};"undefined"!=typeof module&&module.exports?module.exports=g:a.Aria2=g}(this);