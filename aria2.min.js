!function(a){"use strict";var b=function(a,b,c){b=b||"&",c=c||"=";var d="";if("object"==typeof a){for(var e in a)d+=e+c+a[e]+b;d.length>0&&(d="?"+d.slice(0,-1))}return d},c=function(a){var c=b(a.query);return[a.secure?"https":"http","://",a.host,a.port?":"+a.port:"",a.path||"/",c,a.hash||""].join("")},d=a.XMLHttpRequest,e=function(){},f=function(b,d){var e=b.query[b.jsonp],f=c(b),g=document.createElement("script");g.src=f,g.async=!0,a[e]=function(b){d(null,b),delete a[e],delete g.onerror,g.parentNode.remove(g)},g.onerror=function(b){d(b),delete g.onerror,delete a[e],g.parentNode.remove(g)};var h=document.head||document.getElementsByTagName("head")[0];h.appendChild(g)},g=function(a){for(var b=["response","error","end"],g=0;g<b.length;g++)this["on"+b[g]]=e;var h=HTTPClient.utils.handleOptions(a);for(var i in h)this[i]=h[i];if("string"==typeof h.jsonp)return void f(h,function(a,b){a?this.onerror(a):this.onend(b)}.bind(this));var j=new d;j.addEventListener("error",function(a){this.onerror(a)}.bind(this)),j.addEventListener("readystatechange",function(){if(2===j.readyState){var a={},b=j.getAllResponseHeaders();if(b)for(var c=b.split("\n"),d=0;d<c.length;d++)if(c[d]){var e=c[d].split(":");a[e[0].toLowerCase()]=e.slice(1).join().trim()}var f=j.status;this.onresponse({headers:a,status:f,type:HTTPClient.utils.getTypeFromHeaders(a)})}else 4===j.readyState&&this.onend(j.response)}.bind(this)),j.open(h.method,c(h),!0);for(var k in h.headers)j.setRequestHeader(k,h.headers[k]);j.send(h.body),this.req=j};g.prototype.abort=function(){this.req.abort()},a.HTTPRequest=g}(this),function(a){"use strict";var b;b="undefined"!=typeof module&&module.exports?require("./lib/node"):a.HTTPRequest;var c=function(a,c){if(!c)return new b(a);var d=new b(a);d.onerror=function(a){c(a)};var e;return d.onresponse=function(a){e=a},d.onend=function(a){e=e||{},e.body=a,c(null,e)},d};"undefined"!=typeof module&&module.exports?module.exports=c:a.HTTPClient=c}(this),function(a){"use strict";var b;b="undefined"!=typeof Buffer?function(a){return new Buffer(a).toString("base64")}:a.btoa;var c=function(a){return Object.getPrototypeOf?Object.getPrototypeOf(a):a.__proto__},d=c({}),e=function(a){return"object"!=typeof a?!1:c(a)===d||null===c(a)},f=function(a){var c={};c.query="object"==typeof a.query?a.query:{},c.secure=!!a.secure||!1,c.port=a.port||(c.secure?443:80),c.host=a.host||"localhost",c.path=a.path||"/",c.headers="object"==typeof a.headers?a.headers:{},c.method="string"==typeof a.method?a.method.toUpperCase():"GET",a.jsonp===!0&&(a.jsonp="callback"),"string"==typeof a.jsonp&&(c.jsonp=a.jsonp,c.query[a.jsonp]="HTTPClient"+Date.now());for(var d in c.headers){var f=c.headers[d];delete c.headers[d],c.headers[d.toLowerCase()]=f}if("string"==typeof a.username&&"string"==typeof a.password){var g=a.username+":"+a.password;c.headers.authorization="Basic "+b(g)}return Array.isArray(a.body)||e(a.body)?(c.body=JSON.stringify(a.body),c.headers["tontent-type"]||(c.headers["content-type"]="application/json; charset=utf-8")):"string"==typeof a.body?(c.body=a.body,c.headers["content-type"]||(c.headers["content-type"]="text/plain; charset=utf-8")):(void 0!==a.body||null!==a.body)&&(c.body=a.body),c},g=function(a){var b="";if("object"==typeof a){var c=a["content-type"];c&&(b=c.split(";")[0])}return b},h={handleOptions:f,getTypeFromHeaders:g,getPrototypeOf:c};"undefined"!=typeof module&&module.exports?module.exports=h:a.HTTPClient.utils=h}(this),function(a){"use strict";var b,c,d;"undefined"!=typeof module&&module.exports?(b=require("ws"),c=function(a){return new Buffer(a).toString("base64")},d=require("httpclient")):(b=a.WebSocket,c=a.atob,d=a.HTTPClient);var e={secure:!1,host:"localhost",port:6800},f=function(a){this.callbacks={},this.lastId=0;for(var b in e)this[b]="object"==typeof a&&b in a?a[b]:e[b]};f.prototype.http=function(a,b){var e={host:this.host,port:this.port,path:"/jsonrpc",secure:this.secure,query:{method:a.method,id:a.id}};Array.isArray(a.params)&&a.params.length>0&&(e.query.params=c(JSON.stringify(a.params))),"undefined"==typeof module&&(e.jsonp="jsoncallback"),d(e,function(a,c){if(a)return b(a);var d=e.jsonp?c.body:JSON.parse(c.body.toString());this._onmessage(d)}.bind(this))},f.prototype.send=function(a,b){var c={method:"aria2."+a,"json-rpc":"2.0",id:this.lastId++};if(arguments.length>1){b=[];for(var d=1;d<arguments.length;d++){if("function"==typeof arguments[d]){this.callbacks[c.id]=arguments[d];break}b.push(arguments[d])}b.length>0&&(c.params=b)}return this.onsend(c),this.socket&&1===this.socket.readyState?this.socket.send(JSON.stringify(c)):void this.http(c,function(a){this.callbacks[c.id](a),delete this.callbacks[c.id]}.bind(this))},f.prototype._onmessage=function(a){if(void 0!==a.id){var b=this.callbacks[a.id];b&&(a.error?b(a.error):a.result&&b(void 0,a.result),delete this.callbacks[a.id])}else if(a.method){var c=a.method.split("aria2.")[1];c in f.notifications&&this[c](a.params)}this.onmessage(a)},f.prototype.open=function(a){a=a||(this.secure?"wss":"ws")+"://"+this.host+":"+this.port+"/jsonrpc",this.socket=new b(a),this.socket.onopen=this.onopen.bind(this),this.socket.onclose=this.onclose.bind(this),this.socket.onmessage=function(a){this._onmessage(JSON.parse(a.data))}.bind(this)},f.prototype.close=function(){this.socket.close()},f.methods={addUri:{},addTorrent:{},addMetalink:{},remove:{},forceRemove:{},pause:{},pauseAll:{},forcePause:{},forcePauseAll:{},unpause:{},unpauseAll:{},tellStatus:{},getUris:{},getFiles:{},getPeers:{},getServers:{},tellActive:{},tellWaiting:{},tellStopped:{},changePosition:{},changeUri:{},getOption:{},changeOption:{},getGlobalOption:{},changeGlobalOption:{},getGlobalStat:{},purgeDownloadResult:{},removeDownloadResult:{},getVersion:{},getSessionInfo:{},shutdown:{},forceShutdown:{}},f.notifications={onDownloadStart:{},onDownloadPause:{},onDownloadStop:{},onDownloadComplete:{},onDownloadError:{},onBtDownloadComplete:{}};for(var g in f.methods)!function(a){f.prototype[a]=function(){this.send(a,arguments[0],arguments[1])}}(g);for(var h in f.notifications)f.prototype[h]=function(){};["open","close","send","message"].forEach(function(a){f.prototype["on"+a]=function(){}}),"undefined"!=typeof module&&module.exports?module.exports=f:a.Aria2=f}(this);